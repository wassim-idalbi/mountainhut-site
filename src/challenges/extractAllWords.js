import e from"../utils/toast.js";export default class{constructor(e,t,s){this.challengeId=e,this.puzzleData=t,this.hints=s,this.targetWords=t.words.map(e=>e.toUpperCase()),this.foundWords=[],this.currentWord="",this.selectedCells=[],this.$screen=null}init(){this.$screen=$(`[data-challenge-id="${this.challengeId}"]`),this.$screen.length?(this.reset(),this.attachEventHandlers(),this.updateFoundWordsDisplay(),console.log(`ExtractAllWords challenge initialized: ${this.challengeId}`)):console.error(`Challenge screen not found: ${this.challengeId}`)}attachEventHandlers(){$(document).on("click",`[data-challenge-id="${this.challengeId}"] .letter-cell`,e=>{this.onLetterClick($(e.currentTarget))}),this.$screen.find(".btn-primary").on("click",()=>{this.checkAnswer()}),this.$screen.find(".hint-btn").on("click",()=>{this.showHint()})}onLetterClick(e){if(e.hasClass("used"))return;const t=e.text(),s=this.$screen.find(".letter-cell").index(e);e.hasClass("selected")?this.selectedCells[this.selectedCells.length-1]===s&&(e.removeClass("selected"),this.selectedCells.pop(),this.currentWord=this.currentWord.slice(0,-1),this.updateCurrentWordDisplay()):(e.addClass("selected"),this.selectedCells.push(s),this.currentWord+=t,this.updateCurrentWordDisplay(),this.autoCheckAnswer())}updateCurrentWordDisplay(){const e=this.$screen.find(".current-word-display");if(this.currentWord.length>0)e.text(this.currentWord);else{const t="ar"===gameState.currentLanguage?"اضغط على الحروف لتكوين كلمة":"Click on letters to form a word";e.text(t)}}autoCheckAnswer(){const t=this.currentWord.toUpperCase();if(this.targetWords.includes(t)&&!this.foundWords.includes(t))if(this.foundWords.push(t),this.markUsedCells(),this.clearCurrentWord(),this.updateFoundWordsDisplay(),this.foundWords.length===this.targetWords.length)this.onSuccess();else{const t="ar"===gameState.currentLanguage?"كلمة صحيحة!":"Correct word!";e.success(t,2e3)}}checkAnswer(){const t=this.currentWord.toUpperCase();if(0===t.length){const t="ar"===gameState.currentLanguage?"اختر حروف لتكوين كلمة":"Select letters to form a word";return e.warning(t),!1}if(this.targetWords.includes(t)&&!this.foundWords.includes(t)){if(this.foundWords.push(t),this.markUsedCells(),this.clearCurrentWord(),this.updateFoundWordsDisplay(),this.foundWords.length===this.targetWords.length)this.onSuccess();else{const t="ar"===gameState.currentLanguage?"كلمة صحيحة!":"Correct word!";e.success(t,2e3)}return!0}if(this.foundWords.includes(t)){const t="ar"===gameState.currentLanguage?"هذه الكلمة موجودة بالفعل":"Word already found";return e.info(t),this.clearCurrentWord(),!1}{const t="ar"===gameState.currentLanguage?"كلمة خاطئة. حاول مرة أخرى":"Incorrect word. Try again";return e.error(t),this.clearCurrentWord(),!1}}markUsedCells(){this.selectedCells.forEach(e=>{this.$screen.find(".letter-cell").eq(e).addClass("used")})}clearCurrentWord(){this.currentWord="",this.selectedCells=[],this.$screen.find(".letter-cell").removeClass("selected"),this.updateCurrentWordDisplay()}updateFoundWordsDisplay(){const e=this.$screen.find(".found-word-slot"),t=this.$screen.find(".found-words-title"),s="ar"===gameState.currentLanguage?`الكلمات المكتشفة (${this.foundWords.length}/${this.targetWords.length}):`:`Found Words (${this.foundWords.length}/${this.targetWords.length}):`;t.text(s),e.each((e,t)=>{const s=$(t);e<this.foundWords.length?s.text(this.foundWords[e]).addClass("found"):s.text("???").removeClass("found")})}onSuccess(){const t="ar"===gameState.currentLanguage?"ممتاز! وجدت جميع الكلمات! 🎉":"Excellent! You found all words! 🎉";e.success(t),setTimeout(()=>{$(document).trigger("challengeComplete",[this.challengeId])},500)}showHint(){const t=gameState.hintsUsed[this.challengeId];if(t>=gameState.maxHintsPerChallenge){const t="ar"===gameState.currentLanguage?"انتهت التلميحات":"No hints remaining";return void e.warning(t)}const s=this.hints[t];this.displayHintInBox(s),gameState.useHint(this.challengeId),this.updateHintDisplay()}displayHintInBox(e){const t=this.$screen.find(".hints-container"),s=t.find(".hint-btn");t.find(".hint-display").length?t.find(".hint-display").text(`💡 ${e}`):s.before(`<div class="hint-display">💡 ${e}</div>`)}updateHintDisplay(){const e=gameState.getRemainingHints(this.challengeId),t=this.$screen.find(".hints-title"),s="ar"===gameState.currentLanguage?`💡 التلميحات المتاحة (${e}/3):`:`💡 Available Hints (${e}/3):`;t.text(s),0===e&&this.$screen.find(".hint-btn").prop("disabled",!0).addClass("disabled")}reset(){this.foundWords=[],this.clearCurrentWord(),this.updateFoundWordsDisplay(),this.$screen.find(".hint-display").remove(),this.updateHintDisplay()}destroy(){$(document).off("click",`[data-challenge-id="${this.challengeId}"] .letter-cell`),this.$screen.find(".btn-primary").off("click"),this.$screen.find(".hint-btn").off("click"),console.log(`ExtractAllWords challenge destroyed: ${this.challengeId}`)}}